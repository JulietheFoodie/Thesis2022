---
title: "Loop Data Upload"
author: "Julie Norman"
date: '2022-06-20'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Libraries

```{r}
library(tidyverse)
library(janitor)
```

## States Data Upload

Must convert to xlsx and delete * definition in years 2013 and 2014 for code to run

### Alabama

```{r}

al_files <- list.files("Data Sets/Alabama Data Source/Alabama xlsx/")

for(i in 1:length(al_files)) { 
  for (j in 2:5) {
    
  # Head of for-loop
  assign(paste0("al1", i, "_df", LETTERS[j]),                                   
  # Read and store data frames
         read.xlsx(paste0("Data Sets/Alabama Data Source/Alabama xlsx/",
                   al_files[i]), 
                   sheet = (j),
                   fillMergedCells = TRUE, 
                   colNames = FALSE))
    
  }
}

# Extra sheet in year 2013
al13_dfF <- read.xlsx("Data Sets/Alabama Data Source/Alabama xlsx/AnyConv.com__2013 County Health Ranking Alabama Data - v1_1.xlsx", 
    sheet = 6,
    fillMergedCells = TRUE, colNames = FALSE)



```

### Delaware

```{r}

de_files <- list.files("Data Sets/Delaware Data Source/Delaware xlsx/")

for(i in 1:length(de_files)) { 
  for (j in 2:5) {
    
  # Head of for-loop
  assign(paste0("de1", i, "_df", LETTERS[j]),                                   
  # Read and store data frames
         read.xlsx(paste0("Data Sets/Delaware Data Source/Delaware xlsx/",
                   de_files[i]), 
                   sheet = (j),
                   fillMergedCells = TRUE, 
                   colNames = FALSE))
    
  }
}

# Extra sheet in year 2013
de13_dfF <- read.xlsx("Data Sets/Delaware Data Source/Delaware xlsx/AnyConv.com__2013 County Health Ranking Delaware Data - v1_0.xlsx", 
    sheet = 6,
    fillMergedCells = TRUE, colNames = FALSE)



```

### Florida 

```{r}

fl_files <- list.files("Data Sets/Florida Data Source/Florida xlsx/")

for(i in 1:length(fl_files)) { 
  for (j in 2:5) {
    
  # Head of for-loop
  assign(paste0("fl1", i, "_df", LETTERS[j]),                                   
  # Read and store data frames
         read.xlsx(paste0("Data Sets/Florida Data Source/Florida xlsx/",
                   fl_files[i]), 
                   sheet = (j),
                   fillMergedCells = TRUE, 
                   colNames = FALSE))
    
  }
}

# Extra sheet in year 2013
fl13_dfF <- read.xlsx("Data Sets/Florida Data Source/Florida xlsx/AnyConv.com__2013 County Health Ranking Florida Data - v1_0.xlsx", 
    sheet = 6,
    fillMergedCells = TRUE, colNames = FALSE)


```

### Georgia

```{r}

ga_files <- list.files("Data Sets/Georgia Data Source/Georgia xlsx/")

for(i in 1:length(ga_files)) { 
  for (j in 2:5) {
    
  # Head of for-loop
  assign(paste0("ga1", i, "_df", LETTERS[j]),                                   
  # Read and store data frames
         read.xlsx(paste0("Data Sets/Georgia Data Source/Georgia xlsx/",
                   ga_files[i]), 
                   sheet = (j),
                   fillMergedCells = TRUE, 
                   colNames = FALSE))
    
  }
}

# Extra sheet in year 2013
ga13_dfF <- read.xlsx("Data Sets/Georgia Data Source/Georgia xlsx/AnyConv.com__2013 County Health Ranking Georgia Data - v1_0.xlsx", 
    sheet = 6,
    fillMergedCells = TRUE, colNames = FALSE)

```

### Illinois

```{r}

il_files <- list.files("Data Sets/Illinois Data Source/Illinois xlsx/")

for(i in 1:length(il_files)) { 
  for (j in 2:5) {
    
  # Head of for-loop
  assign(paste0("il1", i, "_df", LETTERS[j]),                                   
  # Read and store data frames
         read.xlsx(paste0("Data Sets/Illinois Data Source/Illinois xlsx/",
                   il_files[i]), 
                   sheet = (j),
                   fillMergedCells = TRUE, 
                   colNames = FALSE))
    
  }
}

# Extra sheet in year 2013
il13_dfF <- read.xlsx("Data Sets/Illinois Data Source/Illinois xlsx/AnyConv.com__2013 County Health Ranking Illinois Data - v1_0.xlsx", 
    sheet = 6,
    fillMergedCells = TRUE, colNames = FALSE)

```

### Indiana

```{r}

in_files <- list.files("Data Sets/Indiana Data Source/Indiana xlsx/")

for(i in 1:length(in_files)) { 
  for (j in 2:5) {
    
  # Head of for-loop
  assign(paste0("in1", i, "_df", LETTERS[j]),                                   
  # Read and store data frames
         read.xlsx(paste0("Data Sets/Indiana Data Source/Indiana xlsx/",
                   in_files[i]), 
                   sheet = (j),
                   fillMergedCells = TRUE, 
                   colNames = FALSE))
    
  }
}

# Extra sheet in year 2013
in13_dfF <- read.xlsx("Data Sets/Indiana Data Source/Indiana xlsx/AnyConv.com__2013 County Health Ranking Indiana Data - v1_0.xlsx", 
    sheet = 6,
    fillMergedCells = TRUE, colNames = FALSE)

```



### Kansas

```{r}

ks_files <- list.files("Data Sets/Kansas Data Source/Kansas xlsx/")

for(i in 1:length(ks_files)) { 
  for (j in 2:5) {
    
  # Head of for-loop
  assign(paste0("ks1", i, "_df", LETTERS[j]),                                   
  # Read and store data frames
         read.xlsx(paste0("Data Sets/Kansas Data Source/Kansas xlsx/",
                   ks_files[i]), 
                   sheet = (j),
                   fillMergedCells = TRUE, 
                   colNames = FALSE))
    
  }
}

# Extra sheet in year 2013
ks13_dfF <- read.xlsx("Data Sets/Kansas Data Source/Kansas xlsx/AnyConv.com__2013 County Health Ranking Kansas Data - v1_0.xlsx", 
    sheet = 6,
    fillMergedCells = TRUE, colNames = FALSE)

```

### Kentucky

```{r}

ky_files <- list.files("Data Sets/Kentucky Data Source/Kentucky xlsx/")

for(i in 1:length(ky_files)) { 
  for (j in 2:5) {
    
  # Head of for-loop
  assign(paste0("ky1", i, "_df", LETTERS[j]),                                   
  # Read and store data frames
         read.xlsx(paste0("Data Sets/Kentucky Data Source/Kentucky xlsx/",
                   ky_files[i]), 
                   sheet = (j),
                   fillMergedCells = TRUE, 
                   colNames = FALSE))
    
  }
}

# Extra sheet in year 2013
ky13_dfF <- read.xlsx("Data Sets/Kentucky Data Source/Kentucky xlsx/AnyConv.com__2013 County Health Ranking Kentucky Data - v1_0.xlsx", 
    sheet = 6,
    fillMergedCells = TRUE, colNames = FALSE)

```

### Maryland

```{r}

md_files <- list.files("Data Sets/Maryland Data Source/Maryland xlsx/")

for(i in 1:length(md_files)) { 
  for (j in 2:5) {
    
  # Head of for-loop
  assign(paste0("md1", i, "_df", LETTERS[j]),                                   
  # Read and store data frames
         read.xlsx(paste0("Data Sets/Maryland Data Source/Maryland xlsx/",
                   md_files[i]), 
                   sheet = (j),
                   fillMergedCells = TRUE, 
                   colNames = FALSE))
    
  }
}

# Extra sheet in year 2013
md13_dfF <- read.xlsx("Data Sets/Maryland Data Source/Maryland xlsx/AnyConv.com__2013 County Health Ranking Maryland Data - v1_0.xlsx", 
    sheet = 6,
    fillMergedCells = TRUE, colNames = FALSE)


```

### Minnesota

```{r}

mn_files <- list.files("Data Sets/Minnesota Data Source/Minnesota xlsx/")

for(i in 1:length(mn_files)) { 
  for (j in 2:5) {
    
  # Head of for-loop
  assign(paste0("mn1", i, "_df", LETTERS[j]),                                   
  # Read and store data frames
         read.xlsx(paste0("Data Sets/Minnesota Data Source/Minnesota xlsx/",
                   mn_files[i]), 
                   sheet = (j),
                   fillMergedCells = TRUE, 
                   colNames = FALSE))
    
  }
}

# Extra sheet in year 2013
mn13_dfF <- read.xlsx("Data Sets/Minnesota Data Source/Minnesota xlsx/AnyConv.com__2013 County Health Ranking Minnesota Data - v1_0.xlsx", 
    sheet = 6,
    fillMergedCells = TRUE, colNames = FALSE)


```

### Mississippi

```{r}

ms_files <- list.files("Data Sets/Mississippi Data Source/Mississippi xlsx/")

for(i in 1:length(ms_files)) { 
  for (j in 2:5) {
    
  # Head of for-loop
  assign(paste0("ms1", i, "_df", LETTERS[j]),                                   
  # Read and store data frames
         read.xlsx(paste0("Data Sets/Mississippi Data Source/Mississippi xlsx/",
                   ms_files[i]), 
                   sheet = (j),
                   fillMergedCells = TRUE, 
                   colNames = FALSE))
    
  }
}

# Extra sheet in year 2013
ms13_dfF <- read.xlsx("Data Sets/Mississippi Data Source/Mississippi xlsx/AnyConv.com__2013 County Health Ranking Mississippi Data - v1_0.xlsx", 
    sheet = 6,
    fillMergedCells = TRUE, colNames = FALSE)

```


### Nevada

```{r}

nv_files <- list.files("Data Sets/Nevada Data Source/Nevada xlsx/")

for(i in 1:length(nv_files)) { 
  for (j in 2:5) {
    
  # Head of for-loop
  assign(paste0("nv1", i, "_df", LETTERS[j]),                                   
  # Read and store data frames
         read.xlsx(paste0("Data Sets/Nevada Data Source/Nevada xlsx/",
                   nv_files[i]), 
                   sheet = (j),
                   fillMergedCells = TRUE, 
                   colNames = FALSE))
    
  }
}

# Extra sheet in year 2013
nv13_dfF <- read.xlsx("Data Sets/Nevada Data Source/Nevada xlsx/AnyConv.com__2013 County Health Ranking Nevada Data - v1_0.xlsx", 
    sheet = 6,
    fillMergedCells = TRUE, colNames = FALSE)


```

### New Mexico

```{r}

nm_files <- list.files("Data Sets/New Mexico Data Source/New Mexico xlsx/")

for(i in 1:length(nm_files)) { 
  for (j in 2:5) {
    
  # Head of for-loop
  assign(paste0("nm1", i, "_df", LETTERS[j]),                                   
  # Read and store data frames
         read.xlsx(paste0("Data Sets/New Mexico Data Source/New Mexico xlsx/",
                   nm_files[i]), 
                   sheet = (j),
                   fillMergedCells = TRUE, 
                   colNames = FALSE))
    
  }
}

# Extra sheet in year 2013
nm13_dfF <- read.xlsx("Data Sets/New Mexico Data Source/New Mexico xlsx/AnyConv.com__2013 County Health Ranking New Mexico Data - v1_0.xlsx", 
    sheet = 6,
    fillMergedCells = TRUE, colNames = FALSE)


```

### North Carolina

```{r}
# Data upload 

nc_files <- list.files("Data Sets/North Carolina Data Source/North Carolina xlsx/")

for(i in 1:length(nc_files)) { 
  for (j in 2:5) {
    
  # Head of for-loop
  assign(paste0("nc1", i, "_df", LETTERS[j]),                                   
  # Read and store data frames
         read.xlsx(paste0("Data Sets/North Carolina Data Source/North Carolina xlsx/",
                   nc_files[i]), 
                   sheet = (j),
                   fillMergedCells = TRUE, 
                   colNames = FALSE))
    
  }
}

# Extra sheet in year 2013
nc13_dfF <- read.xlsx("Data Sets/North Carolina Data Source/North Carolina xlsx/AnyConv.com__2013 County Health Ranking North Carolina Data - v1_0.xlsx", 
    sheet = 6,
    fillMergedCells = TRUE, colNames = FALSE)

```

### North Dakota

```{r}
# Data upload 

nd_files <- list.files("Data Sets/North Dakota Data Source/North Dakota xlsx/")

for(i in 1:length(nd_files)) { 
  for (j in 2:5) {
    
  # Head of for-loop
  assign(paste0("nd1", i, "_df", LETTERS[j]),                                   
  # Read and store data frames
         read.xlsx(paste0("Data Sets/North Dakota Data Source/North Dakota xlsx/",
                   nd_files[i]), 
                   sheet = (j),
                   fillMergedCells = TRUE, 
                   colNames = FALSE))
    
  }
}

# Extra sheet in year 2013
nd13_dfF <- read.xlsx("Data Sets/North Dakota Data Source/North Dakota xlsx/AnyConv.com__2013 County Health Ranking North Dakota Data - v1_0.xlsx", 
    sheet = 6,
    fillMergedCells = TRUE, colNames = FALSE)

```

### Ohio

```{r}
# Data upload 

oh_files <- list.files("Data Sets/Ohio Data Source/Ohio xlsx/")

for(i in 1:length(oh_files)) { 
  for (j in 2:5) {
    
  # Head of for-loop
  assign(paste0("oh1", i, "_df", LETTERS[j]),                                   
  # Read and store data frames
         read.xlsx(paste0("Data Sets/Ohio Data Source/Ohio xlsx/",
                   oh_files[i]), 
                   sheet = (j),
                   fillMergedCells = TRUE, 
                   colNames = FALSE))
    
  }
}

# Extra sheet in year 2013
oh13_dfF <- read.xlsx("Data Sets/Ohio Data Source/Ohio xlsx/AnyConv.com__2013 County Health Ranking Ohio Data - v1_0.xlsx", 
    sheet = 6,
    fillMergedCells = TRUE, colNames = FALSE)

```

### South Carolina

```{r}
# Data upload 

sc_files <- list.files("Data Sets/South Carolina Data Source/South Carolina xlsx/")

for(i in 1:length(sc_files)) { 
  for (j in 2:5) {
    
  # Head of for-loop
  assign(paste0("sc1", i, "_df", LETTERS[j]),                                   
  # Read and store data frames
         read.xlsx(paste0("Data Sets/South Carolina Data Source/South Carolina xlsx/",
                   sc_files[i]), 
                   sheet = (j),
                   fillMergedCells = TRUE, 
                   colNames = FALSE))
    
  }
}

# Extra sheet in year 2013
sc13_dfF <- read.xlsx("Data Sets/South Carolina Data Source/South Carolina xlsx/AnyConv.com__2013 County Health Ranking South Carolina Data - v1_0.xlsx", 
    sheet = 6,
    fillMergedCells = TRUE, colNames = FALSE)

```

### South Dakota

```{r}
# Data upload 

sd_files <- list.files("Data Sets/South Dakota Data Source/South Dakota xlsx/")

for(i in 1:length(sc_files)) { 
  for (j in 2:5) {
    
  # Head of for-loop
  assign(paste0("sd1", i, "_df", LETTERS[j]),                                   
  # Read and store data frames
         read.xlsx(paste0("Data Sets/South Dakota Data Source/South Dakota xlsx/",
                   sd_files[i]), 
                   sheet = (j),
                   fillMergedCells = TRUE, 
                   colNames = FALSE))
    
  }
}

# Extra sheet in year 2013
sd13_dfF <- read.xlsx("Data Sets/South Dakota Data Source/South Dakota xlsx/AnyConv.com__2013 County Health Ranking South Dakota Data - v1_0.xlsx", 
    sheet = 6,
    fillMergedCells = TRUE, colNames = FALSE)

```

### Tennessee

```{r}
# Data upload 

tn_files <- list.files("Data Sets/Tennessee Data Source/Tennessee xlsx/")

for(i in 1:length(tn_files)) { 
  for (j in 2:5) {
    
  # Head of for-loop
  assign(paste0("tn1", i, "_df", LETTERS[j]),                                   
  # Read and store data frames
         read.xlsx(paste0("Data Sets/Tennessee Data Source/Tennessee xlsx/",
                   tn_files[i]), 
                   sheet = (j),
                   fillMergedCells = TRUE, 
                   colNames = FALSE))
    
  }
}

# Extra sheet in year 2013
tn13_dfF <- read.xlsx("Data Sets/Tennessee Data Source/Tennessee xlsx/AnyConv.com__2013 County Health Ranking Tennessee Data - v1_0.xlsx", 
    sheet = 6,
    fillMergedCells = TRUE, colNames = FALSE)

```



### West Virginia

```{r}
# Data upload 

wv_files <- list.files("Data Sets/West Virginia Data Source/West Virginia xlsx/")

for(i in 1:length(wv_files)) { 
  for (j in 2:5) {
    
  # Head of for-loop
  assign(paste0("wv1", i, "_df", LETTERS[j]),                                   
  # Read and store data frames
         read.xlsx(paste0("Data Sets/West Virginia Data Source/West Virginia xlsx/",
                   wv_files[i]), 
                   sheet = (j),
                   fillMergedCells = TRUE, 
                   colNames = FALSE))
    
  }
}

# Extra sheet in year 2013
wv13_dfF <- read.xlsx("Data Sets/West Virginia Data Source/West Virginia xlsx/AnyConv.com__2013 County Health Ranking West Virginia Data - v1_0.xlsx", 
    sheet = 6,
    fillMergedCells = TRUE, colNames = FALSE)

```

### Wisconsin

```{r}
# Data upload 

wi_files <- list.files("Data Sets/Wisconsin Data Source/Wisconsin xlsx/")

for(i in 1:length(wi_files)) { 
  for (j in 2:5) {
    
  # Head of for-loop
  assign(paste0("wi1", i, "_df", LETTERS[j]),                                   
  # Read and store data frames
         read.xlsx(paste0("Data Sets/Wisconsin Data Source/Wisconsin xlsx/",
                   wi_files[i]), 
                   sheet = (j),
                   fillMergedCells = TRUE, 
                   colNames = FALSE))
    
  }
}

# Extra sheet in year 2013
wi13_dfF <- read.xlsx("Data Sets/Wisconsin Data Source/Wisconsin xlsx/AnyConv.com__2013 County Health Ranking Wisconsin Data - v1_0.xlsx", 
    sheet = 6,
    fillMergedCells = TRUE, colNames = FALSE)

```

### Wyoming

```{r}
# Data upload 

wy_files <- list.files("Data Sets/Wyoming Data Source/Wyoming xlsx/")

for(i in 1:length(wy_files)) { 
  for (j in 2:5) {
    
  # Head of for-loop
  assign(paste0("wy1", i, "_df", LETTERS[j]),                                   
  # Read and store data frames
         read.xlsx(paste0("Data Sets/Wyoming Data Source/Wyoming xlsx/",
                   wy_files[i]), 
                   sheet = (j),
                   fillMergedCells = TRUE, 
                   colNames = FALSE))
    
  }
}

# Extra sheet in year 2013
wy13_dfF <- read.xlsx("Data Sets/Wyoming Data Source/Wyoming xlsx/AnyConv.com__2013 County Health Ranking Wyoming Data - v1_0.xlsx", 
    sheet = 6,
    fillMergedCells = TRUE, colNames = FALSE)

```




## Combine Data by Year

```{r}
state_all <- c("al", "fl", "ga", "il", "in", "ks", "ky", "md", "mn", "ms", "nv", "nm", "nc", "nd", "oh", "sc", "sd", "tn", "wv", "wi", "wy")

state1 <- c("al", "fl", "ga", "il", "in", "ks", "ky",  "mn", "ms",   "nc", "nd",  "sc", "sd", "tn", "wv", "wi", "wy")

state2 <- c("de", "md", "nv", "nm", "oh")
# "de"
```


### 2011

```{r}

datalist11 = list()

for(i in state){

# put all data frames into list
assign(paste0(i, "11df_list"),
       list(get(paste0(i, "11_dfB")), 
            get(paste0(i, "11_dfC")), 
            get(paste0(i, "11_dfD")), 
            get(paste0(i, "11_dfE"))))
    
# merge all data frames in list
assign(paste0(i, "11D_df"),
       (get(paste0(i, "11df_list")) %>% 
          reduce(full_join, by = 'X1')
        ))

# Delete Duplicate Columns and row (unsure where row came from)
assign(paste0(i, "11D_df2"), get(paste0(i, "11D_df")) %>%
         slice(-2) %>%
         select(-which(duplicated(as.list(get(paste0(i, "11D_df"))))))
         )

# merge first two rows for new column names
 assign(paste0(i, "11D_newnames"), paste(
             slice(get(paste0(i, "11D_df2")), 1),
             slice(get(paste0(i, "11D_df2")), 2),
             sep = '.'))
 
 # delete old column rows
assign(paste0(i, "11D_df3"), get(paste0(i, "11D_df2")) %>%
         slice(-c(1, 2))) 
 
# add new column names
assign(paste0(i, "11_df"), 
       setnames(get(paste0(i, "11D_df3")), 
                colnames(get(paste0(i, "11D_df2"))), 
                get(paste0(i, "11D_newnames"))))

# Add Year
Year <- 2011
assign(paste0(i, "11_df"), cbind(get(paste0(i, "11_df")), Year))


# List of Datasets
datalist11[[i]] <- get(paste0(i, "11_df"))


}

# Combine Datasets
all_df11 <- do.call(rbind, datalist11)

# lowercase column names
names(all_df11) <- tolower(names(all_df11))

  
 all_df11$demographics.population <- all_df11[[147]]
 
 all_df11$demographics.populationB <- all_df11[[155]]

# Find Unique Column Names
unique_names <- unique(colnames(all_df11))

# Keep Only Unique Column Names
all_df11 <- all_df11[unique_names]


```

### 2012

```{r}

datalist12A = list()

for(i in state1){

# put all data frames into list
assign(paste0(i, "12df_list"),
       list(get(paste0(i, "12_dfB")), 
            get(paste0(i, "12_dfC")), 
            get(paste0(i, "12_dfD")), 
            get(paste0(i, "12_dfE"))))
    
# merge all data frames in list
assign(paste0(i, "12D_df"),
       (get(paste0(i, "12df_list")) %>% 
          reduce(full_join, by = 'X1')
        ))

# Delete Duplicate Columns and row (unsure where row came from)
assign(paste0(i, "12D_df2"), get(paste0(i, "12D_df")) %>%
         select(-which(duplicated(as.list(get(paste0(i, "12D_df"))))))
         )

# merge first two rows for new column names
 assign(paste0(i, "12D_newnames"), paste(
             slice(get(paste0(i, "12D_df2")), 1),
             slice(get(paste0(i, "12D_df2")), 2),
             sep = '.'))
 
 # delete old column rows
assign(paste0(i, "12D_df3"), get(paste0(i, "12D_df2")) %>%
         slice(-c(1, 2))) 
 
# add new column names
assign(paste0(i, "12_df"), 
       setnames(get(paste0(i, "12D_df3")), 
                colnames(get(paste0(i, "12D_df2"))), 
                get(paste0(i, "12D_newnames"))))

# Add Year
Year <- 2012
assign(paste0(i, "12_df"), cbind(get(paste0(i, "12_df")), Year))


# List of Datasets
datalist12A[[i]] <- get(paste0(i, "12_df"))


}

# Combine Datasets
all_df12A <- do.call(rbind, datalist12A)

# lowercase column names
names(all_df12A) <- tolower(names(all_df12A))

all_df12A$demographics.population <- all_df12A[[156]]

all_df12A$demographics.populationB <- all_df12A[[164]]

# Find Unique Column Names
unique_names <- unique(colnames(all_df12A))

# Keep Only Unique Column Names
all_df12A <- all_df12A[unique_names]

```

```{r}

datalist12B = list()

for(i in state2){

# put all data frames into list
assign(paste0(i, "12df_list"),
       list(get(paste0(i, "12_dfB")), 
            get(paste0(i, "12_dfC")), 
            get(paste0(i, "12_dfD")), 
            get(paste0(i, "12_dfE"))))
    
# merge all data frames in list
assign(paste0(i, "12D_df"),
       (get(paste0(i, "12df_list")) %>% 
          reduce(full_join, by = 'X1')
        ))

# Delete Duplicate Columns and row (unsure where row came from)
assign(paste0(i, "12D_df2"), get(paste0(i, "12D_df")) %>%
         select(-which(duplicated(as.list(get(paste0(i, "12D_df"))))))
         )

# merge first two rows for new column names
 assign(paste0(i, "12D_newnames"), paste(
             slice(get(paste0(i, "12D_df2")), 1),
             slice(get(paste0(i, "12D_df2")), 3),
             sep = '.'))
 
 # delete old column rows
assign(paste0(i, "12D_df3"), get(paste0(i, "12D_df2")) %>%
         slice(-c(1, 2, 3))) 
 
# add new column names
assign(paste0(i, "12_df"), 
       setnames(get(paste0(i, "12D_df3")), 
                colnames(get(paste0(i, "12D_df2"))), 
                get(paste0(i, "12D_newnames"))))

# Add Year
Year <- 2012
assign(paste0(i, "12_df"), cbind(get(paste0(i, "12_df")), Year))


# List of Datasets
datalist12B[[i]] <- get(paste0(i, "12_df"))


}

# Combine Datasets
all_df12B <- do.call(rbind, datalist12B)

# lowercase column names
names(all_df12B) <- tolower(names(all_df12B))

all_df12B$demographics.population <- all_df12B[[156]]

all_df12B$demographics.populationB <- all_df12B[[164]]

# Find Unique Column Names
unique_names <- unique(colnames(all_df12B))

# Keep Only Unique Column Names
all_df12B <- all_df12B[unique_names]

```


```{r}
alll_df12 <- rbind(all_df12A, all_df12B)
```


### 2013 

```{r}

datalist13 = list()

for(i in state){

# put all data frames into list
assign(paste0(i, "13df_list"),
       list(get(paste0(i, "13_dfB")), 
            get(paste0(i, "13_dfC")), 
            get(paste0(i, "13_dfD")), 
            get(paste0(i, "13_dfE")), 
            get(paste0(i, "13_dfF"))))
    
# merge all data frames in list
assign(paste0(i, "13D_df"),
       (get(paste0(i, "13df_list")) %>% 
          reduce(full_join, by = 'X1')
        ))

# Delete Duplicate Columns and row (unsure where row came from)
assign(paste0(i, "13D_df2"), get(paste0(i, "13D_df")) %>%
         select(-which(duplicated(as.list(get(paste0(i, "13D_df"))))))
         )

# merge first two rows for new column names
 assign(paste0(i, "13D_newnames"), paste(
             slice(get(paste0(i, "13D_df2")), 1),
             slice(get(paste0(i, "13D_df2")), 2),
             sep = '.'))
 
 # delete old column rows
assign(paste0(i, "13D_df3"), get(paste0(i, "13D_df2")) %>%
         slice(-c(1, 2))) 
 
# add new column names
assign(paste0(i, "13_df"), 
       setnames(get(paste0(i, "13D_df3")), 
                colnames(get(paste0(i, "13D_df2"))), 
                get(paste0(i, "13D_newnames"))))

# Add Year
Year <- 2013
assign(paste0(i, "13_df"), cbind(get(paste0(i, "13_df")), Year))


# List of Datasets
datalist13[[i]] <- get(paste0(i, "13_df"))


}

# Combine Datasets
all_df13 <- do.call(rbind, datalist13)

# lowercase column names
names(all_df13) <- tolower(names(all_df13))


# Find Unique Column Names
unique_names <- unique(colnames(all_df13))

# Keep Only Unique Column Names
all_df13 <- all_df13[unique_names]



```


### 2014 

```{r}

datalist14 = list()

for(i in state){

# put all data frames into list
assign(paste0(i, "14df_list"),
       list(get(paste0(i, "14_dfB")), 
            get(paste0(i, "14_dfC")), 
            get(paste0(i, "14_dfD")), 
            get(paste0(i, "14_dfE"))))
    
# merge all data frames in list
assign(paste0(i, "14D_df"),
       (get(paste0(i, "14df_list")) %>% 
          reduce(full_join, by = 'X1')
        ))

# Delete Duplicate Columns and row (unsure where row came from)
assign(paste0(i, "14D_df2"), get(paste0(i, "14D_df")) %>%
         select(-which(duplicated(as.list(get(paste0(i, "14D_df"))))))
         )

# merge first two rows for new column names


 assign(paste0(i, "14D_newnames"), paste(
             slice(get(paste0(i, "14D_df2")), 1),
             slice(get(paste0(i, "14D_df2")), 5),
             sep = '.'))
 
 # delete old column rows
assign(paste0(i, "14D_df3"), get(paste0(i, "14D_df2")) %>%
         slice(-c(1, 2, 3, 4, 5))) 
 
# add new column names
assign(paste0(i, "14_df"), 
       setnames(get(paste0(i, "14D_df3")), 
                colnames(get(paste0(i, "14D_df2"))), 
                get(paste0(i, "14D_newnames"))))

# Add Year
Year <- 2014
assign(paste0(i, "14_df"), cbind(get(paste0(i, "14_df")), Year))


# List of Datasets
datalist14[[i]] <- get(paste0(i, "14_df"))


}

# Combine Datasets
all_df14 <- do.call(rbind, datalist14)

# lowercase column names
names(all_df14) <- tolower(names(all_df14))

# Find Unique Column Names
unique_names <- unique(colnames(all_df14))

# Keep Only Unique Column Names
all_df14 <- all_df14[unique_names]


```

### 2015

```{r}

datalist15 = list()

for(i in state){

# put all data frames into list
assign(paste0(i, "15df_list"),
       list(get(paste0(i, "15_dfB")), 
            get(paste0(i, "15_dfC")), 
            get(paste0(i, "15_dfD")), 
            get(paste0(i, "15_dfE"))))
    
# merge all data frames in list
assign(paste0(i, "15D_df"),
       (get(paste0(i, "15df_list")) %>% 
          reduce(full_join, by = 'X1')
        ))

# Delete Duplicate Columns and row (unsure where row came from)
assign(paste0(i, "15D_df2"), get(paste0(i, "15D_df")) %>%
         slice(-c(2, 3, 4)) %>%
         select(-which(duplicated(as.list(get(paste0(i, "15D_df"))))))
         )

# merge first two rows for new column names
 assign(paste0(i, "15D_newnames"), paste(
             slice(get(paste0(i, "15D_df2")), 1),
             slice(get(paste0(i, "15D_df2")), 2),
             sep = '.'))
 
 # delete old column rows
assign(paste0(i, "15D_df3"), get(paste0(i, "15D_df2")) %>%
         slice(-c(1, 2))) 
 
# add new column names
assign(paste0(i, "15_df"), 
       setnames(get(paste0(i, "15D_df3")), 
                colnames(get(paste0(i, "15D_df2"))), 
                get(paste0(i, "15D_newnames"))))

# Add Year
Year <- 2015
assign(paste0(i, "15_df"), cbind(get(paste0(i, "15_df")), Year))


# List of Datasets
datalist15[[i]] <- get(paste0(i, "15_df"))


}

# Combine Datasets
all_df15 <- do.call(rbind, datalist15)

# lowercase column names
names(all_df15) <- tolower(names(all_df15))

# Find Unique Column Names
unique_names <- unique(colnames(all_df15))

# Keep Only Unique Column Names
all_df15 <- all_df15[unique_names]

```


### 2016

```{r}

datalist16 = list()

for(i in state){

# put all data frames into list
assign(paste0(i, "16df_list"),
       list(get(paste0(i, "16_dfB")), 
            get(paste0(i, "16_dfC")), 
            get(paste0(i, "16_dfD")), 
            get(paste0(i, "16_dfE"))))
    
# merge all data frames in list
assign(paste0(i, "16D_df"),
       (get(paste0(i, "16df_list")) %>% 
          reduce(full_join, by = 'X1')
        ))

# Delete Duplicate Columns and row (unsure where row came from)
assign(paste0(i, "16D_df2"), get(paste0(i, "16D_df")) %>%
         slice(-c(2, 3, 4)) %>%
         select(-which(duplicated(as.list(get(paste0(i, "16D_df"))))))
         )

# merge first two rows for new column names
 assign(paste0(i, "16D_newnames"), paste(
             slice(get(paste0(i, "16D_df2")), 1),
             slice(get(paste0(i, "16D_df2")), 2),
             sep = '.'))
 
 # delete old column rows
assign(paste0(i, "16D_df3"), get(paste0(i, "16D_df2")) %>%
         slice(-c(1, 2))) 
 
# add new column names
assign(paste0(i, "16_df"), 
       setnames(get(paste0(i, "16D_df3")), 
                colnames(get(paste0(i, "16D_df2"))), 
                get(paste0(i, "16D_newnames"))))

# Add Year
Year <- 2016
assign(paste0(i, "16_df"), cbind(get(paste0(i, "16_df")), Year))

# List of Datasets
datalist16[[i]] <- get(paste0(i, "16_df"))


}

# Combine Datasets
all_df16 <- do.call(bind_rows, datalist16)

# lowercase column names
names(all_df16) <- tolower(names(all_df16))

# Find Unique Column Names
unique_names <- unique(colnames(all_df16))

# Keep Only Unique Column Names
all_df16 <- all_df16[unique_names]


```

### 2017

```{r}

datalist17 = list()

for(i in state){

# put all data frames into list
assign(paste0(i, "17df_list"),
       list(get(paste0(i, "17_dfB")), 
            get(paste0(i, "17_dfC")), 
            get(paste0(i, "17_dfD")), 
            get(paste0(i, "17_dfE"))))
    
# merge all data frames in list
assign(paste0(i, "17D_df"),
       (get(paste0(i, "17df_list")) %>% 
          reduce(full_join, by = 'X1')
        ))

# Delete Duplicate Columns and row (unsure where row came from)
assign(paste0(i, "17D_df2"), get(paste0(i, "17D_df")) %>%
         select(-which(duplicated(as.list(get(paste0(i, "17D_df"))))))
         )

# merge first two rows for new column names
 assign(paste0(i, "17D_newnames"), paste(
             slice(get(paste0(i, "17D_df2")), 1),
             slice(get(paste0(i, "17D_df2")), 2),
             sep = '.'))
 
 # delete old column rows
assign(paste0(i, "17D_df3"), get(paste0(i, "17D_df2")) %>%
         slice(-c(1, 2))) 
 
# add new column names
assign(paste0(i, "17_df"), 
       setnames(get(paste0(i, "17D_df3")), 
                colnames(get(paste0(i, "17D_df2"))), 
                get(paste0(i, "17D_newnames"))))

# Add Year
Year <- 2017
assign(paste0(i, "17_df"), cbind(get(paste0(i, "17_df")), Year))

# List of Datasets
datalist17[[i]] <- get(paste0(i, "17_df"))


}

# Combine Datasets

all_df17 <- do.call(bind_rows, datalist17)  

# uneeded
# all_df17 <-  all_df17 %>% 
#   mutate(na.county = 
#            coalesce(all_df17$na.cou,
#                     all_df17$`NA.County...20` )) 


# Drop redundant columns (uneeded)
#all_df17 <- subset(all_df17, select = -c(NA.County, NA.County...20, NA.County...3))

# lowercase column names
names(all_df17) <- tolower(names(all_df17))




# Find Unique Column Names
unique_names <- unique(colnames(all_df17))

# Keep Only Unique Column Names
all_df17 <- all_df17[unique_names]




```

### 2018

```{r}

datalist18 = list()

for(i in state){

# put all data frames into list
assign(paste0(i, "18df_list"),
       list(get(paste0(i, "18_dfB")), 
            get(paste0(i, "18_dfC")), 
            get(paste0(i, "18_dfD")), 
            get(paste0(i, "18_dfE"))))
    
# merge all data frames in list
assign(paste0(i, "18D_df"),
       (get(paste0(i, "18df_list")) %>% 
          reduce(full_join, by = 'X1')
        ))

# Delete Duplicate Columns and row (unsure where row came from)
assign(paste0(i, "18D_df2"), get(paste0(i, "18D_df")) %>%
         select(-which(duplicated(as.list(get(paste0(i, "18D_df"))))))
         )

# merge first two rows for new column names
 assign(paste0(i, "18D_newnames"), paste(
             slice(get(paste0(i, "18D_df2")), 1),
             slice(get(paste0(i, "18D_df2")), 2),
             sep = '.'))
 
 # delete old column rows
assign(paste0(i, "18D_df3"), get(paste0(i, "18D_df2")) %>%
         slice(-c(1, 2))) 
 
# add new column names
assign(paste0(i, "18_df"), 
       setnames(get(paste0(i, "18D_df3")), 
                colnames(get(paste0(i, "18D_df2"))), 
                get(paste0(i, "18D_newnames"))))

# Add Year
Year <- 2018
assign(paste0(i, "18_df"), cbind(get(paste0(i, "18_df")), Year))

# List of Datasets
datalist18[[i]] <- get(paste0(i, "18_df"))


}

# Combine Datasets
all_df18 <- do.call(rbind, datalist18)

# lowercase column names
names(all_df18) <- tolower(names(all_df18))

# Find Unique Column Names
unique_names <- unique(colnames(all_df18))

# Keep Only Unique Column Names
all_df18 <- all_df18[unique_names]

```

### 2019

```{r}

datalist19 = list()

for(i in state){

# put all data frames into list
assign(paste0(i, "19df_list"),
       list(get(paste0(i, "19_dfB")), 
            get(paste0(i, "19_dfC")), 
            get(paste0(i, "19_dfD")), 
            get(paste0(i, "19_dfE"))))
    
# merge all data frames in list
assign(paste0(i, "19D_df"),
       (get(paste0(i, "19df_list")) %>% 
          reduce(full_join, by = 'X1')
        ))

# Delete Duplicate Columns and row (unsure where row came from)
assign(paste0(i, "19D_df2"), get(paste0(i, "19D_df")) %>%
         select(-which(duplicated(as.list(get(paste0(i, "19D_df"))))))
         )

# merge first two rows for new column names
 assign(paste0(i, "19D_newnames"), paste(
             slice(get(paste0(i, "19D_df2")), 1),
             slice(get(paste0(i, "19D_df2")), 2),
             sep = '.'))
 
 # delete old column rows
assign(paste0(i, "19D_df3"), get(paste0(i, "19D_df2")) %>%
        slice(-c(1, 2))) 
 
# add new column names
assign(paste0(i, "19_df"), 
       setnames(get(paste0(i, "19D_df3")), 
                colnames(get(paste0(i, "19D_df2"))), 
                get(paste0(i, "19D_newnames"))))

# Add Year
Year <- 2019
assign(paste0(i, "19_df"), cbind(get(paste0(i, "19_df")), Year))

# List of Datasets
datalist19[[i]] <- get(paste0(i, "19_df"))


}

# Combine Datasets
all_df19 <- do.call(rbind, datalist19)

# lowercase column names
names(all_df19) <- tolower(names(all_df19))

# Find Unique Column Names
unique_names <- unique(colnames(all_df19))

# Keep Only Unique Column Names
all_df19 <- all_df19[unique_names]


```

## Combine all data years

```{r}
datalist <- list()

for(i in 1:9){
  
  # list of yearly dataframes
  datalist[[i]] <- get(paste0("all_df1", i))
  
}
# Combine Datasets
all_df <- do.call(bind_rows, datalist)


```

## Final Data Cleaning

```{r}
# add treatment Column 
state <- all_df$na.state

all_df$treatment <- ifelse(state == "Arkansas" | state == "Iowa"| state == "Kentucky" | state == "Louisiana" | state == "Minnesota" | state == "Montana" | state == "North Dakota" | state == "Nebraska" | state == "West Virginia" | state == "Virginia", "1", "0" )



# Combine and delete extra columns 
all_df2 <- all_df %>% 
  relocate(c(year, treatment), .before = 'health outcomes.z-score') %>%
  rename(county = na.county, state = na.state, fips = na.fips) %>%
  subset (select = -c(
                       `children in poverty.% children in poverty - black`,
                       `children in poverty.% children in poverty (black)`,
                       `children in poverty.% children in poverty - hispanic`,
                       `children in poverty.% children in poverty (hispanic)`,
                       `children in poverty.% children in poverty - white`,
                       `children in poverty.% children in poverty (white)`,
                       `driving alone to work.% drive alone (black)`,
                       `driving alone to work.% drive alone - black`,
                       `driving alone to work.% drive alone (hispanic)`,
                       `driving alone to work.% drive alone - hispanic`,
                       `driving alone to work.% drive alone (white)`,
                       `driving alone to work.% drive alone - white`,
                       `severe housing problems.# household with severe problems`,
                       `severe housing problems.# households with severe problems`,
                       `demographics.# american indian/ alaskan native`,
                       `demographics.# american indian/alaskan native`,
                       `demographics.# native hawaiian/ other pacific islander`,
                       `demographics.# native hawaiian/other pacific islander`
                       )) %>%
  mutate(`severe housing problems.# household` = 
           coalesce(all_df$`severe housing problems.# household with severe problems`,
                    all_df$`severe housing problems.# households with severe problems` )) %>% 
  mutate(`demographics.# american indian/ native alaskan` = 
           coalesce(all_df$`demographics.# american indian/ alaskan native`,
                    all_df$`demographics.# american indian/alaskan native` )) %>% 
  mutate(`demographics.# native hawaiian/ pacific islander` = 
           coalesce(all_df$`demographics.# native hawaiian/ other pacific islander`,
                    all_df$`demographics.# native hawaiian/other pacific islander` )) %>% 
  
  mutate(`children in poverty.% children in poverty- white` = 
           coalesce(all_df$`children in poverty.% children in poverty - white`,
                    all_df$`children in poverty.% children in poverty (white)` )) %>% 
  mutate(`children in poverty.% children in poverty- black` = 
           coalesce(all_df$`children in poverty.% children in poverty - black`,
                    all_df$`children in poverty.% children in poverty (black)` )) %>% 
  mutate(`children in poverty.% children in poverty- hispanic` = 
           coalesce(all_df$`children in poverty.% children in poverty - hispanic`,
                    all_df$`children in poverty.% children in poverty (hispanic)` )) %>% 
  
  mutate(`driving alone to work.% drive alone- white` = 
           coalesce(all_df$`driving alone to work.% drive alone - white`,
                    all_df$`driving alone to work.% drive alone (white)` )) %>% 
  mutate(`driving alone to work.% drive alone- black` = 
           coalesce(all_df$`driving alone to work.% drive alone - black`,
                    all_df$`driving alone to work.% drive alone (black)` )) %>% 
  mutate(`driving alone to work.% drive alone- hispanic` = 
           coalesce(all_df$`driving alone to work.% drive alone - hispanic`,
                    all_df$`driving alone to work.% drive alone (hispanic)` ))





```

### Divide by State vs County 

```{r}
state_df <- all_df2 %>% 
  filter(is.na(county))

# remove empty columns
state_df <- state_df[ , colSums(is.na(state_df)) < nrow(state_df)] 

county_df <- all_df2 %>% 
  filter(!is.na(county))

```

## Export

```{r}
write.csv(state_df, "state_complete.csv")

write.csv(county_df, "county_complete.csv")
```

#### Need to use

State == "Illinois"| State == "Minnesota" |   State == "North Dakota" | State == "Maryland" | State == "Delaware" | State == "Ohio" | State == "New Mexico"

* Add Maryland Delaware and  ohio new mexico


##### Expanded and Using
* Arkansas 2014 - non traditional waiver
* Iowa 2014 - non traditional waiver
* Kentucky 2014
* Louisiana 2016 
* Minnesota 2014- full
* Montana 2016 - non traditional
* North Dakota 2014
* Nebraska 2020 
* West Virginia 2014
* Virginia 2019 

##### Not Expanded
* Alabama
* Florida
* Georgia 
* Kansas

* Mississippi
* North Carolina Need
* South Dakota
* South Carolina 

* Tennessee
* Wisconsin
* Wyoming